{% extends "base.html" %}

{% block content %}

<h1 class="display-4 logo-font text-black">Order page</h1>
<!-- list of products -->
<h2>Coffee Selection</h2>
<div class="d-flex d-flex-row">
  <div class="card-deck">
    {% for product in product_list %}
      <div class="card">
        <div class="card-body">
            <form action="{% url 'add_to_cart' product.id %}" method="POST">
              {% csrf_token %}
              <h4>{{ product.name }}</h4>
              <p>{{ product.price }}$</p>
              <p>{{ product.category }}</p>
              <p>{{ product.rating }}</p>
            <input type="submit" class="btn btn-outline-dark rounded-0 py-3" value="+">
            <input type="hidden" name="quantity" value="1">
            <input type="hidden" name="redirect_url" value="{{ request.path }}">
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
<!-- View of cart -->
<h1>Checkout</h1>
<h2>items</h2>
<div class="d-flex d-flex-row">
  <div class="card-deck">
    {% for item in cart_items %}
      <div class="card">
        <div class="card-body">
          {{ item.product.name }}
          <form action="{% url 'remove_from_cart' item.product.id %}" method="POST">
            {% csrf_token %}
            <input type="submit" class="btn btn-outline-dark rounded-0 py-3" value="x"></input>
          </form>
          <div class="row">
            <form action="{% url 'adjust_cart_items' item.product.id %}" method="POST">
              {% csrf_token %}
              <input type="submit" value="+" name="increment" class="btn btn-outline-dark rounded-0 py-3"></input>
              {{ item.quantity }}
              <input type="submit" value="-" name="decrement" class="btn btn-outline-dark rounded-0 py-3"></input>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
<h4>total = {{ total }}$</h4>
<form method="POST" action="{% url 'order_confirmation' %}">
  {% csrf_token %}
  <div class="form-group">
    {{ order_form.name }}
  </div>
  <div class="form-group">
    {{ order_form.country }}
  </div>
  <div class="form-group">
    {{ order_form.city }}
  </div>
  <div class="form-group">
    {{ order_form.address }}
  </div>
  <div class="form-group">
    <input type="text" placeholder="xxxx-xxxx-xxxx-xxxx">
  </div>
  <div class="col text-right" id="card-element">
  </div>
</form>
{% endblock %}

{% block postloadjs %}
    {{ block.super }}
    {{ stripe_public_key|json_script:"id_stripe_public_key" }}
    {{ client_secret|json_script:"id_client_secret" }}
    <script src="{% static 'order/js/stripe_elements.js' %}"></script>
{% endblock %}